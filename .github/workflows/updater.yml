name: "Updater"
on:
  schedule:
    - cron: "0 0 * * SUN"
  workflow_dispatch:
defaults:
  run:
    shell: "sh"
concurrency:
  group: "scan-virus-ghaction-updater"
  cancel-in-progress: false
jobs:
  main:
    name: "Main"
    runs-on: "ubuntu-latest"
    steps:
      - name: "Checkout Repository"
        uses: "actions/checkout@v3.5.3"
        with:
          ref: "updater"
          fetch-depth: 0
      - name: "Setup PowerShell Toolkit"
        uses: "hugoalh-studio/setup-powershell-toolkit-ghaction@v1.3.0"
      - name: "Config Git"
        run: |
          git --no-pager config --global "user.name" "github-actions"
          git --no-pager config --global "user.email" "github-actions@users.noreply.github.com"
      - name: "Update Assets"
        id: "update-assets"
        run: |
          pwsh -NonInteractive ./assets/_updater.ps1
      - name: "Push Git Commit"
        if: "${{github.event_name == 'workflow_dispatch' || steps.update-assets.outputs.should_push == 'true'}}"
        run: |
          git --no-pager add --all
          git --no-pager commit --message="Update assets on ${{steps.update-assets.outputs.timestamp}}"
          git --no-pager push
